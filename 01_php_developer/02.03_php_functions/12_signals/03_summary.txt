map и filter можно в одну строчку с помощью стрелочных функций

в array_reduce можно вот так:
        $acc[$domain] = ($acc[$domain] ?? 0) + 1;

